@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model BI.SGP.BLL.Models.RFQDetail
@section head
{

    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9" />
        <title>RFQ Detail</title>




        <link href="~/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="~/assets/css/font-awesome.min.css" />
        <link rel="stylesheet" href="@Url.Content("~/assets/css/jquery-ui-1.10.3.full.min.css")" />
        <link rel="stylesheet" href="~/assets/css/chosen.css" />
        <link rel="stylesheet" href="~/assets/css/datepicker.css" />
        <link rel="stylesheet" href="~/assets/css/bootstrap-timepicker.css" />
        <link rel="stylesheet" href="~/assets/css/daterangepicker.css" />
        <link rel="stylesheet" href="~/assets/css/colorpicker.css" />
        <link rel="stylesheet" href="~/assets/css/opensans.css" />
        <link rel="stylesheet" href="~/assets/css/ace.min.css" />
        <link rel="stylesheet" href="~/assets/css/ace-rtl.min.css" />
        <link rel="stylesheet" href="~/assets/css/ace-skins.min.css" />

        <script src="~/Scripts/jquery.min.js"></script>
        <script src="~/assets/js/ace-extra.min.js"></script>
        <script src="@Url.Content("~/Scripts/publiclib.js")"></script>
        <script src="@Url.Content("~/Scripts/jsDetail.js")"></script>

        <script src="@Url.Content("~/assets/js/jquery-ui-1.10.3.full.min.js")"></script>

        <script src="~/assets/js/jquery.ui.touch-punch.min.js"></script>
        <script src="~/assets/js/chosen.jquery.min.js"></script>
        <script src="~/assets/js/fuelux/fuelux.spinner.min.js"></script>
        <script src="~/assets/js/date-time/bootstrap-datepicker.min.js"></script>
        <script src="~/assets/js/date-time/bootstrap-timepicker.min.js"></script>
        <script src="~/assets/js/date-time/moment.min.js"></script>
        <script src="~/assets/js/date-time/daterangepicker.min.js"></script>
        <script src="~/assets/js/bootstrap-colorpicker.min.js"></script>
        <script src="~/assets/js/jquery.knob.min.js"></script>
        <script src="~/assets/js/jquery.autosize.min.js"></script>
        <script src="~/assets/js/jquery.inputlimiter.1.3.1.min.js"></script>
        <script src="~/assets/js/jquery.maskedinput.min.js"></script>
        <script src="~/assets/js/bootstrap-tag.min.js"></script>

        <!-- ace scripts -->
        <script src="~/assets/js/bootbox.min.js"></script>

        <script src="~/assets/js/bootstrap.min.js"></script>
        <script src="~/assets/js/typeahead-bs2.min.js"></script>
        <script src="~/assets/js/ace-elements.min.js"></script>
        <script src="~/assets/js/ace.min.js"></script>
        <script src="@Url.Content("~/Scripts/leftmenu.js")"></script>

    </head>
}
@section featured
{


    <div class="main-content">
        <script>$.rfqDetail.load('@Url.Content("~/")');</script>
        <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
                try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
            </script>

            <ul class="breadcrumb">
                <li>
                    <i class="icon-home home-icon"></i>
                    <a href="~/Pricing/PricingView">Home</a>
                </li>

                <li>
                    <a href="~/Pricing/Detail">Detail</a>
                </li>

            </ul><!-- .breadcrumb -->


        </div>
        <div class="page-content">

            <div class="row">
                <div class="col-xs-12">
                    <!-- PAGE CONTENT BEGINS -->


                    <div class="row-fluid">
                        <div class="span12">
                            <div class="widget-box">
                                <div class="row-fluid wizard-actions" style="margin-bottom:5px;">
                                    <a id="PDFContent">

                                        @{
                                            string[] WFIDS = { "5", "6", "7" };
                                            if (ViewData["CurrWFID"] != null && ViewData["LastWFID"] != null)
                                            {
                                                if (WFIDS.Contains(ViewData["CurrWFID"].ToString()))
                                                {
                                                    @MvcHtmlString.Create(@"<button id=""btnDownlPDF"" class=""btn btn-purple"" title="""">
                                                                 Download PDF
                                                                <i class=""icon-file small-30""></i>
                                                                 </button>");

                                                }
                                            }
                                        }
                                    </a>



                                    <button id="btnReQuote" class="btn btn-info" title="">
                                        Re-Quote
                                        <i class="icon-save small-30"></i>
                                    </button>
                                    <button id="btnSaveAsNew" class="btn btn-info" title="">
                                        Clone
                                        <i class="icon-save small-30"></i>
                                    </button>
                                    <button id="btnSave" class="btn btn-primary" title="">
                                        Save
                                        <i class="icon-save small-30"></i>
                                    </button>
                                    <button id="btnSubmit" class="btn  btn-success" title="">
                                        <i class="icon-arrow-right icon-on-right"></i>
                                        Submit
                                    </button>
                                    <button id="btnSkip" class="btn btn-danger" data-last="Finish " title="">
                                        Skip
                                        <i class="icon-reply small-30"></i>
                                    </button>
                                    <button id="btnCosting" class="btn btn-purple btnCosting" onclick="window.open('@Url.Content("~/CostIO/Input?RFQID=")'+_dataId)">
                                        Cost Analysis
                                        <i class="icon-zoom-in small-30"></i>
                                    </button>
                                </div>

                                <div class="widget-header widget-header-blue widget-header-flat">
                                    <h4 class="lighter">RFQ Detail</h4>

                                    <div class="widget-toolbar">
                                        <label>
                                            <a href="javascript:void(0)" onclick="return showFilesDialog();" id="UploadAttachment" title="Upload Attachment">
                                                <i class="icon-paper-clip"></i>
                                            </a>
                                        </label>
                                    </div>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main">
                                        <div id="fuelux-wizard" class="row-fluid" data-target="#step-container">
                                            <ul id="wizardWF"></ul>
                                        </div>

                                        <div id="MainRFQContent">
                                            @{
                                                if (ViewData["CurrWFID"] != null)
                                                {

                                                    @MvcHtmlString.Create(@BI.SGP.BLL.UIManager.UIManager.GenrateModelforRFQDetail(Model, ViewData["CurrWFID"].ToString()))
                                                }
                                                else
                                                {
                                                    @MvcHtmlString.Create(@BI.SGP.BLL.UIManager.UIManager.GenrateModelforRFQDetail(Model, "1"))
                                                }

                                            }

                                        </div>

                                        <br />


                                    </div><!-- /widget-main -->

                                </div><!-- /widget-body -->
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid wizard-actions" style="margin-top:5px;">
                        <a id="PDFContentbot">

                            @{
                                string[] wfidbot = { "5", "6", "7" };
                                if (ViewData["CurrWFID"] != null && ViewData["LastWFID"] != null)
                                {
                                    if (wfidbot.Contains(ViewData["CurrWFID"].ToString()))
                                    {
                                        @MvcHtmlString.Create(@"<button id=""btnDownlPDFbot"" class=""btn btn-purple"" title="""">
                                                                 Download PDF
                                                                <i class=""icon-file small-30""></i>
                                                                 </button>");

                                    }
                                }
                            }
                        </a>



                        <button id="btnReQuotebot" class="btn btn-info" title="">
                            Re-Quote
                            <i class="icon-save small-30"></i>
                        </button>
                        <button id="btnSaveAsNewbot" class="btn btn-info" title="">
                            Clone
                            <i class="icon-save small-30"></i>
                        </button>
                        <button id="btnSavebot" class="btn btn-primary" title="">
                            Save
                            <i class="icon-save small-30"></i>
                        </button>
                        <button id="btnSubmitbot" class="btn  btn-success" title="">
                            <i class="icon-arrow-right icon-on-right"></i>
                            Submit
                        </button>
                        <button id="btnSkipbot" class="btn btn-danger" data-last="Finish " title="">
                            Skip
                            <i class="icon-reply small-30"></i>
                        </button>
                        <button id="btnCosting" class="btn btn-purple btnCosting" style="display:none" onclick="window.open('@Url.Content("~/CostIO/Input?RFQID=")'+_dataId)">
                            Cost Analysis
                            <i class="icon-zoom-in small-30"></i>
                        </button>
                    </div>





                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.page-content -->
    </div>

    <script type="text/javascript">
        var _dataId = '@Model.RFQID';
        var rootUrl = '@Url.Content("~/")';


        function downloadpdf() {


            window.open('@Url.Content("~/Pricing/DownloadPDF")' + "?RFQID=" + _dataId);


        }


        function saveCallBack(data) {
            _dataId = data.RFQID;
            saveFiles();
            createWizard(data);
        }

        function saveFiles() {
            if (typeof (updateTempToNormal) == "function") {
                updateTempToNormal();
            }
        }

        function createWizard(data) {
            $.bi.wizard.create({ rootUrl: rootUrl, wizardId: "wizardWF", templateName: "DefaultWF", entityId: _dataId, clickCallback: wizardClickCallback });
        }

        function wizardClickCallback() {
            var curId = 0;
            $("#wizardWF").children().each(function (index, element) {
                curId = $(this).attr("curId");
                var thisId = $(this).attr("actid");
                var thisText = $(this).children()[1].innerText;
                if (curId != thisId) {
                    $(this).children().css("cursor", "pointer");
                    $(this).children().click(function () {
                        $.bi.dialog.show({
                            title: "Skip", content: "Are you sure you want to<br> change the status to [" + thisText + "]?", buttons: [
                            {
                                html: "<i class='icon-ok bigger-110'></i>&nbsp; Yes",
                                "class": "btn btn-success btn-xs",
                                click: function () {
                                    wfSkip(curId, thisId);
                                    $(this).dialog("destroy");
                                }
                            },
                            {
                                html: "<i class='icon-remove bigger-110'></i>&nbsp; No",
                                "class": "btn btn-xs",
                                click: function () {
                                    $(this).dialog("destroy");
                                }
                            }]
                        });
                        //wfSkip(curId, thisId);
                    });
                }
            });

            if(curId == 2) {
                $("#btnCosting").show();
            }else {
                $("#btnCosting").hide();
            }
        }

        $('#btnDownlPDF').click(function () {
            window.open('@Url.Content("~/Pricing/DownloadPDF")' + "?RFQID=" + _dataId);
        });

        $('#btnDownlPDFbot').click(function () {
            window.open('@Url.Content("~/Pricing/DownloadPDF")' + "?RFQID=" + _dataId);
        });

        function saveData(postUrl, callback, toActivityId) {
            $.bi.overlay.show();
            var url = postUrl;

            var jsondata = {}

            //var postdata = '{';
            $(":input").each(function (alldata) {
                var id = $(this).eq(0).prop("id")
                var value = $(this).val();
                jsondata[id] = value;
            });

            jsondata.toActivityId = toActivityId;
            $.ajax({
                type: 'Post',
                url: url,
                data: jsondata,
                datatype: 'json',
                success: function (data) {

                    $('#PDFContent').html(data.PDF);
                    $('#PDFContentbot').html(data.PDF);

                    if (data.SysMsg.isPass == false) {
                        $.bi.dialog.show({ title: 'Message', content: data.SysMsg.MessageString, modal: true, buttons: [] });
                        if (callback != null) {
                            callback(data);
                        }
                    } else {
                        $('#MainRFQContent').html(data.HTML);
                        $.bi.dialog.show({ title: 'Success', content: ' Successful Operation!', width: 300 });
                        if (callback != null) {
                            callback(data);
                        }
                    }
                }
                , complete: function () {
                    $.bi.overlay.hide();
                }
            });
        }

        $(document).ready(function () {
            createWizard({ RFQID: _dataId });

            $('#btnSave').click(function () {
                saveData('@Url.Content("~/Pricing/SaveData")', saveCallBack);
            });
            $('#btnSaveAsNew').click(function () {
                saveData('@Url.Content("~/Pricing/SaveAsData")', saveCallBack);
            });

            $('#btnSubmit').click(function () {
                saveData('@Url.Content("~/Pricing/SaveSubmitData")', saveCallBack);
            });
            $('#btnReQuote').click(function () {
                saveData('@Url.Content("~/Pricing/SaveRequoteData")', saveCallBack);
            });
            $('#btnSkip').click(function () {
                $.bi.wf.skip.show("DefaultWF", _dataId, 'wfSkip');
            });

            $('#btnSavebot').click(function () {
                saveData('@Url.Content("~/Pricing/SaveData")', saveCallBack);
            });
            $('#btnSaveAsNewbot').click(function () {
                saveData('@Url.Content("~/Pricing/SaveAsData")', saveCallBack);
            });

            $('#btnSubmitbot').click(function () {
                saveData('@Url.Content("~/Pricing/SaveSubmitData")', saveCallBack);
            });
            $('#btnReQuotebot').click(function () {
                saveData('@Url.Content("~/Pricing/SaveRequoteData")', saveCallBack);
            });
            $('#btnSkipbot').click(function () {
                $.bi.wf.skip.show("DefaultWF", _dataId, 'wfSkip');
            });

            @*$("#ProjectNumber").unbind('change').change(function () {

                $.post('@Url.Content("~/Setting/GetCostModuel")', { ProjectNumber: $(this).val() }, function (data) {
                    if (data.Plant != "") {
                        if (data.Plant == "B2" || data.Plant == "2F" || data.Plant == "B2F")
                        {
                            $("#Building").val("B2");
                        }
                        else
                        {
                            $("#Building").val(data.Plant);
                        }
                        
                    }
                    if (data.Yield != "") {
                        $("#Yield").val(data.Yield);
                    }
                    if (data.MaterialCost != "") {
                        $("#MaterialCost").val(data.MaterialCost);
                    } if (data.VariableCost != "") {
                        $("#VariableCost").val(data.VariableCost);
                    }
                    if (data.FixedCost != "") {
                        $("#FixedCost").val(data.FixedCost);
                    }
                    if (data.TotalCost != "") {
                        $("#TotalCost").val(data.TotalCost);
                    }
                }, "json");

            })*@



        });

        function wfSkip(curId, toId) {
            $.bi.wf.skip.close(_dataId);
            saveData('@Url.Content("~/Pricing/SaveAndSkip")', saveCallBack, toId);
        }

    </script>






    @Html.Partial("~/Views/Export/Files.cshtml")
    <div style="display:none">
    </div>
}



